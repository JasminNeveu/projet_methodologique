geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "Empirical CDF of p-values (CAH)",
x = "p-value",
y = "F(p)") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
ggplot(df, aes(x = pval)) +
ggplot(df, aes(x = pval)) +
ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "k-means - n_clusters = 3",
x = "p-value"
)+
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "k-means - n_clusters = 3",
x = "p-value",y="")+
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
M <- 1000
M <- 2000
n <- 200
pvals <- numeric(M)
for (m in seq_len(M)) {
X <- rnorm(n)
hc <- hclust(dist(X), method = "average")
clusters <- cutree(hc, k = 3)
sel <- sample(1:3, 2, replace = FALSE)
pvals[m] <- t.test(
X[clusters == sel[1]],
X[clusters == sel[2]]
)$p.value
}
M <- 2000
n <- 200
pvals <- numeric(M)
for (m in seq_len(M)) {
X <- rnorm(n)
hc <- hclust(dist(X), method = "average.D2")
clusters <- cutree(hc, k = 3)
sel <- sample(1:3, 2, replace = FALSE)
pvals[m] <- t.test(
X[clusters == sel[1]],
X[clusters == sel[2]]
)$p.value
}
M <- 2000
n <- 500
pvals <- numeric(M)
for(i in 1:M){
X <- rnorm(n)
kmeans_res <- kmeans(matrix(X, n, 1), centers = 3, nstart = 25)
clusters <- kmeans_res$cluster
selected_clusters = sample(1:3,2,replace= FALSE)
c1 <- selected_clusters[1]
c2 <- selected_clusters[2]
pvals[i] <- t.test(
X[clusters == c1],
X[clusters == c2]
)$p.value
}
for(i in 1:M){
X <- rnorm(n)
kmeans_res <- kmeans(matrix(X, n, 1), centers = 3, nstart = 25)
clusters <- kmeans_res$cluster
selected_clusters = sample(1:3,2,replace= FALSE)
c1 <- selected_clusters[1]
c2 <- selected_clusters[2]
pvals[i] <- t.test(
X[clusters == c1],
X[clusters == c2]
)$p.value
}
ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "k-means - n_clusters = 3",
x = "p-value",
y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
M <- 2000
n <- 200
pvals <- numeric(M)
for (m in seq_len(M)) {
X <- rnorm(n)
hc <- hclust(dist(X), method = "average.D2")
clusters <- cutree(hc, k = 3)
sel <- sample(1:3, 2, replace = FALSE)
pvals[m] <- t.test(
X[clusters == sel[1]],
X[clusters == sel[2]]
)$p.value
}
for (m in seq_len(M)) {
X <- rnorm(n)
hc <- hclust(dist(X), method = "average")
clusters <- cutree(hc, k = 3)
sel <- sample(1:3, 2, replace = FALSE)
pvals[m] <- t.test(
X[clusters == sel[1]],
X[clusters == sel[2]]
)$p.value
}
n <- 2000
pvals <- numeric(M)
for (m in seq_len(M)) {
X <- rnorm(n)
hc <- hclust(dist(X), method = "average")
clusters <- cutree(hc, k = 3)
sel <- sample(1:3, 2, replace = FALSE)
pvals[m] <- t.test(
X[clusters == sel[1]],
X[clusters == sel[2]]
)$p.value
}
ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "HAC - n_clusters = 3",
x = "p-value",y="")+
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
for (m in seq_len(M)) {
X <- rnorm(n)
hc <- hclust(dist(X), method = "average")
clusters <- cutree(hc, k = 3)
sel <- sample(1:3, 2, replace = FALSE)
pvals[m] <- t.test(
X[clusters == sel[1]],
X[clusters == sel[2]]
)$p.value
}
```{r}
M <- 2000
n <- 2000
pvals <- numeric(M)
for (m in seq_len(M)) {
X <- rnorm(n)
hc <- hclust(dist(X), method = "average")
clusters <- cutree(hc, k = 3)
cluster_sizes <- table(clusters)
valid_sel <- sample(which(cluster_sizes >= 2), 2, replace = FALSE)
if(length(valid_sel) == 2) {
pvals[m] <- t.test(X[clusters == valid_sel[1]], X[clusters == valid_sel[2]])$p.value
} else {
pvals[m] <- NA  # Skip invalid iterations
}
}
for (m in seq_len(M)) {
X <- rnorm(n)
hc <- hclust(dist(X), method = "average")
clusters <- cutree(hc, k = 3)
cluster_sizes <- table(clusters)
valid_sel <- sample(which(cluster_sizes >= 2), 2, replace = FALSE)
if(length(valid_sel) == 2) {
pvals[m] <- t.test(X[clusters == valid_sel[1]], X[clusters == valid_sel[2]])$p.value
} else {
pvals[m] <- NA
}
}
df <- data.frame(pval = pvals[!is.na(pvals)])
ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "HAC - n_clusters = 3",
x = "p-value", y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
View(df)
ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "k-means - n_clusters = 3",
x = "p-value",
y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
ggsave("cah_pvalues.png", plot = p, width = 8, height = 6, dpi = 300)
p <-ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "k-means - n_clusters = 3",
x = "p-value",
y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
ggsave("cah_pvalues.png", plot = p, width = 8, height = 6, dpi = 300)
d <- ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "HAC - n_clusters = 3",
x = "p-value", y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
ggsave("cah_plot.png", plot = d, width = 8, height = 6, dpi = 300)
ggsave("kmeans_pvalues.png", plot = p, width = 8, height = 6, dpi = 300)
ggsave("kmeans_pvalues.png", plot = p, width = 8, height = 6, dpi = 300)
d <- ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "HAC - n_clusters = 3",
x = "p-value", y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
ggsave("cah_plot.png", plot = d, width = 8, height = 6, dpi = 300)
p <-ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "k-means - n_clusters = 3",
x = "p-value",
y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
ggsave("kmeans_pvalues.png", plot = p, width = 8, height = 6, dpi = 300)
setwd("~/Documents/2A-ENSAI/S1/selective_inference/src/selective_inference")
ggsave("kmeans_pvalues.png", plot = p, width = 8, height = 6, dpi = 300)
ggsave("cah_plot.png", plot = d, width = 8, height = 6, dpi = 300)
p <-ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "k-means - n_clusters = 3",
x = "p-value",
y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
ggsave("kmeans_pvalues.png", plot = p, width = 8, height = 6, dpi = 300)
d <- ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "HAC - n_clusters = 3",
x = "p-value", y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
ggsave("cah_plot.png", plot = d, width = 8, height = 6, dpi = 300)
d <- ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "HAC - n_clusters = 3",
x = "p-value", y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
ggsave("cah_pvalues.png", plot = d, width = 8, height = 6, dpi = 300)
n <- 1000
pvals <- numeric(M)
for(i in 1:M){
X <- rnorm(n)
kmeans_res <- kmeans(matrix(X, n, 1), centers = 3, nstart = 25)
clusters <- kmeans_res$cluster
selected_clusters = sample(1:3,2,replace= FALSE)
c1 <- selected_clusters[1]
c2 <- selected_clusters[2]
pvals[i] <- t.test(
X[clusters == c1],
X[clusters == c2]
)$p.value
}
for(i in 1:M){
X <- rnorm(n)
kmeans_res <- kmeans(matrix(X, n, 1), centers = 3, nstart = 25)
clusters <- kmeans_res$cluster
selected_clusters = sample(1:3,2,replace= FALSE)
c1 <- selected_clusters[1]
c2 <- selected_clusters[2]
pvals[i] <- t.test(
X[clusters == c1],
X[clusters == c2]
)$p.value
}
p <-ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "k-means - n_clusters = 3",
x = "p-value",
y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
ggsave("kmeans_pvalues.png", plot = p, width = 8, height = 6, dpi = 300)
M <- 2000
n <- 1000
pvals <- numeric(M)
for (m in seq_len(M)) {
X <- rnorm(n)
hc <- hclust(dist(X), method = "average")
clusters <- cutree(hc, k = 3)
cluster_sizes <- table(clusters)
valid_sel <- sample(which(cluster_sizes >= 2), 2, replace = FALSE)
if(length(valid_sel) == 2) {
pvals[m] <- t.test(X[clusters == valid_sel[1]], X[clusters == valid_sel[2]])$p.value
} else {
pvals[m] <- NA
}
}
set.seed(123)
n <- 200
X <- matrix(rnorm(n * d), n, d)
n <- 200
d <- 8
X <- matrix(rnorm(n * d), n, d)
beta <- c(3, 1.5, 0, 0, 2, 0, 0, 0)
y <- X %*% beta + rnorm(n, sd = 1)
pvals <- numeric(M)
for (m in 1:M) {
X <- matrix(rnorm(n * p), n, p)
y <- X %*% beta_true + rnorm(n, sd = 1)
cv_fit <- cv.glmnet(X, y, alpha = 1)  # Lasso
coef_lasso <- coef(cv_fit, s = "lambda.min")
nonzero_idx <- which(coef_lasso[-1, ] != 0) + 1  # Nonzero coeffs (skip intercept)
if(length(nonzero_idx) >= 2) {
sel_coef <- sample(nonzero_idx, 1)  # Random nonzero coef
# Test H0: beta_sel = 0
X_sel <- X[, sel_coef]
t_result <- summary(lm(y ~ X_sel))$coefficients
pvals[m] <- t_result[2, 4]  # p-value
} else {
pvals[m] <- NA
}
}
for (m in 1:M) {
X <- matrix(rnorm(n * d), n, d)
y <- X %*% beta_true + rnorm(n, sd = 1)
cv_fit <- cv.glmnet(X, y, alpha = 1)  # Lasso
coef_lasso <- coef(cv_fit, s = "lambda.min")
nonzero_idx <- which(coef_lasso[-1, ] != 0) + 1  # Nonzero coeffs (skip intercept)
if(length(nonzero_idx) >= 2) {
sel_coef <- sample(nonzero_idx, 1)  # Random nonzero coef
# Test H0: beta_sel = 0
X_sel <- X[, sel_coef]
t_result <- summary(lm(y ~ X_sel))$coefficients
pvals[m] <- t_result[2, 4]  # p-value
} else {
pvals[m] <- NA
}
}
for (m in 1:M) {
X <- matrix(rnorm(n * d), n, d)
y <- X %*% beta + rnorm(n, sd = 1)
cv_fit <- cv.glmnet(X, y, alpha = 1)  # Lasso
coef_lasso <- coef(cv_fit, s = "lambda.min")
nonzero_idx <- which(coef_lasso[-1, ] != 0) + 1  # Nonzero coeffs (skip intercept)
if(length(nonzero_idx) >= 2) {
sel_coef <- sample(nonzero_idx, 1)  # Random nonzero coef
# Test H0: beta_sel = 0
X_sel <- X[, sel_coef]
t_result <- summary(lm(y ~ X_sel))$coefficients
pvals[m] <- t_result[2, 4]  # p-value
} else {
pvals[m] <- NA
}
}
set.seed(123)
n <- 200
d <- 8
pvals <- numeric(M)
for (m in 1:M) {
X <- matrix(rnorm(n * d), n, d)
y <- X %*% beta + rnorm(n, sd = 1)
cv_fit <- cv.glmnet(X, y, alpha = 1)  # Lasso
coef_lasso <- coef(cv_fit, s = "lambda.min")
nonzero_idx <- which(coef_lasso[-1, ] != 0) + 1  # Nonzero coeffs (skip intercept)
if(length(nonzero_idx) >= 2) {
sel_coef <- sample(nonzero_idx, 1)  # Random nonzero coef
# Test H0: beta_sel = 0
X_sel <- X[, sel_coef]
t_result <- summary(lm(y ~ X_sel))$coefficients
pvals[m] <- t_result[2, 4]  # p-value
} else {
pvals[m] <- NA
}
}
for (m in 1:M) {
X <- matrix(rnorm(n * d), n, d)
y <- X %*% beta + rnorm(n, sd = 1)
cv_fit <- cv.glmnet(X, y, alpha = 1)
coef_lasso <- coef(cv_fit, s = "lambda.min")
nonzero_idx <- which(as.vector(coef_lasso[-1, ]) != 0)
if(length(nonzero_idx) >= 1) {
sel_coef <- sample(nonzero_idx, 1)
X_sel <- X[, sel_coef]
t_result <- summary(lm(y ~ X_sel))$coefficients
pvals[m] <- t_result[2, 4]
} else {
pvals[m] <- NA
}
}
for (m in 1:M) {
X <- matrix(rnorm(n * d), n, d)
y <- X %*% beta + rnorm(n, sd = 1)
cv_fit <- cv.glmnet(X, y, alpha = 1)
coef_lasso <- coef(cv_fit, s = "lambda.min")
nonzero_idx <- which(as.vector(coef_lasso[-1, ]) != 0)
if(length(nonzero_idx) >= 1) {
sel_coef <- sample(nonzero_idx, 1)
X_sel <- X[, sel_coef]
t_result <- summary(lm(y ~ X_sel))$coefficients
pvals[m] <- t_result[2, 4]
} else {
pvals[m] <- NA
}
}
d <- ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "Regression Lasso",
x = "p-value", y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0
gsave("lasso_pvalues.png", plot = d, width = 8, height = 6, dpi = 300)
d <- ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "Regression Lasso",
x = "p-value", y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
ggsave("lasso_pvalues.png", plot = d, width = 8, height = 6, dpi = 300)
d <- ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "red", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "Regression Lasso",
x = "p-value", y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
ggsave("lasso_pvalues.png", plot = d, width = 8, height = 6, dpi = 300)
d <- ggplot(df, aes(x = pval)) +
stat_ecdf(geom = "step", color = "blue", size = 0.5) +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed", size = 0.5) +
labs(title = "Regression Lasso",
x = "p-value", y = "") +
theme_minimal() +
scale_x_continuous(limits = c(0, 1)) +
scale_y_continuous(limits = c(0, 1))
ggsave("lasso_pvalues.png", plot = d, width = 8, height = 6, dpi = 300)
for (m in 1:M) {
X <- matrix(rnorm(n * d), n, d)
y <- X %*% beta + rnorm(n, sd = 1)
cv_fit <- cv.glmnet(X, y, alpha = 1)
coef_lasso <- coef(cv_fit, s = "lambda.min")
nonzero_idx <- which(as.vector(coef_lasso[-1, ]) != 0)
sel_coef <- sample(nonzero_idx, 1)
X_sel <- X[, sel_coef]
t_result <- summary(lm(y ~ X_sel))$coefficients
pvals[m] <- t_result[2, 4]
}
for (m in 1:M) {
X <- matrix(rnorm(n * d), n, d)
y <- X %*% beta + rnorm(n, sd = 1)
cv_fit <- cv.glmnet(X, y, alpha = 1)
coef_lasso <- coef(cv_fit, s = "lambda.min")
nonzero_idx <- which(as.vector(coef_lasso[-1, ]) != 0)
if(length(nonzero_idx) >= 1) {
sel_coef <- sample(nonzero_idx, 1)
X_sel <- X[, sel_coef]
t_result <- summary(lm(y ~ X_sel))$coefficients
pvals[m] <- t_result[2, 4]
} else {
pvals[m] <- NA
}
}
for (m in 1:M) {
X <- matrix(rnorm(n * d), n, d)
y <- X %*% beta + rnorm(n, sd = 1)
cv_fit <- cv.glmnet(X, y, alpha = 1)
coef_lasso <- coef(cv_fit, s = "lambda.min")
nonzero_idx <- which(as.vector(coef_lasso[-1, ]) != 0)
if(length(nonzero_idx) >= 1) {
sel_coef <- sample(nonzero_idx, 1)
X_sel <- X[, sel_coef]
t_result <- summary(lm(y ~ X_sel))$coefficients
pvals[m] <- t_result[2, 4]
} else {
pvals[m] <- NA
}
}
beta <- c(3,1.5,0,0,2,0,0,0)
for (m in 1:M) {
X <- matrix(rnorm(n * d), n, d)
y <- X %*% beta + rnorm(n, sd = 1)
cv_fit <- cv.glmnet(X, y, alpha = 1)
coef_lasso <- coef(cv_fit, s = "lambda.min")
nonzero_idx <- which(as.vector(coef_lasso[-1, ]) != 0)
if(length(nonzero_idx) >= 1) {
sel_coef <- sample(nonzero_idx, 1)
X_sel <- X[, sel_coef]
t_result <- summary(lm(y ~ X_sel))$coefficients
pvals[m] <- t_result[2, 4]
} else {
pvals[m] <- NA
}
}
